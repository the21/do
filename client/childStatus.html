<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title></title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">

</head>
<body>

    <div class="container-fluid main">
        <div class="col-md-8 content">

            <table>
                <tr>
                    <td>
                        <span class="mega-header">Temperature</span>
                    </td>
                    <td>
                        <span id="temperature" style="margin-left: 10px" class="mega-header"/>
                    </td>
                    <td>
                        <span class="mega-header">C</span>
                    </td>
                    <td>
                        <span id="datetime" class="mega-header"  style="margin-left: 10px;font-size: 30px;"></span>
                    </td>
                </tr>
            </table>
            <svg id="visualisation" width="1000" height="500" style=" margin-left: 0;"></svg>
        </div>
    </div>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap&#45;theme.min.css"> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="scripts/deviceDataRepository.js"></script>


</div>

<script type="text/javascript">

    function onGetData(deviceData) {
        $('#temperature').text(deviceData.data);
        $('#datetime').text(' at '+ deviceData.time);
        // console.log(deviceData);
    }

    deviceRepository.setGetDataCallback(onGetData);
    deviceRepository.setDelay(2000);
    deviceRepository.process();

    var n = 40,
            random = d3.random.normal(0, .2);

    function chart(domain, interpolation, tick) {
        var data = d3.range(n).map(random);

        var margin = {top: 6, right: 0, bottom: 6, left: 40},
                width = 960 - margin.right,
                height = 120 - margin.top - margin.bottom;

        var x = d3.scale.linear()
                .domain(domain)
                .range([0, width]);

        var y = d3.scale.linear()
                .domain([-1, 1])
                .range([height, 0]);

        var line = d3.svg.line()
                .interpolate(interpolation)
                .x(function (d, i) {
                    return x(i);
                })
                .y(function (d, i) {
                    return y(d);
                });

        var svg = d3.select("#visualisation")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("defs").append("clipPath")
                .attr("id", "clip")
                .append("rect")
                .attr("width", width)
                .attr("height", height);

        svg.append("g")
                .attr("class", "y axis")
                .call(d3.svg.axis().scale(y).ticks(5).orient("left"));

        var path = svg.append("g")
                .attr("clip-path", "url(#clip)")
                .append("path")
                .data([data])
                .attr("class", "line")
                .attr("d", line);

        tick(path, line, data, x);

        return{
            addPoint:function(point){

                // push a new data point onto the back
                data.push(point);
// redraw the line, and then slide it to the left
                path
                        .attr("d", line)
                        .attr("transform", null)
                        .transition()
                        .duration(750)
                        .ease("linear")
                        .attr("transform", "translate(" + x(-1) + ")");

// pop the old data point off the front
                data.shift();


            }
        }
    };

    var test = chart([0, n - 1], "linear", function tick(path, line, data, x) {

    });

    test.addPoint(Math.random());

</script>

</body>
</html>

